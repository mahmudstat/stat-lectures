<head>
<style>
#drawingCanvas {
  position: fixed;
  top: 0; left: 0;
  width: 100vw; height: 100vh;
  z-index: 1000;
  touch-action: none;
  pointer-events: none;
}
#controlsWrapper {
  position: fixed;
  top: 10px; left: 10px;
  z-index: 1001;
}
#controls {
  display: none;
  flex-direction: column;
  align-items: center;
  background: #b3b3ff;
  padding: 5px;
  border-radius: 10px;
  gap: 5px;
}

#controls input, #controls button {
  width: 40px; height: 40px;
}
#toggleControls {
  background: none; border: none; width: 40px; height: 40px; font-size: 23px;
}
#eraserCursor {
  position: fixed; pointer-events: none;
  border: 2px solid red; border-radius: 50%;
  display: none; z-index: 1002;
}

#bgColorLabel, #penColorLabel, #penTool, #eraserTool, #resetBg, #undo, #clear {
  cursor: pointer;
  font-size: 1.4em;
  padding: 6px;
  border-radius: 6px;
  background-color: #ccccff;
  box-shadow: 0 0 3px rgba(0, 0, 0, 0.2);
}

#penSize, #eraserSize { accent-color: green; }

#penColorLabel i {
  transition: color 0.3s;
}

</style>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>

<div id="controlsWrapper">
  <button id="toggleControls" title="Toggle Drawing Controls" style="font-size: 1.9em; color: red;">
  <i class="fas fa-pen-nib"></i>
</button>
  <div id="controls">
    <label style="font-weight: bold; color: #8f246b;"  id="penTool" title="Pen Tool"><i class="fas fa-marker"></i></label>
    <input type="color" id="penColor" value="#339966" style="display: none;" />
<label for="penColor" id="penColorLabel" title="Pen Color">
  <i class="fas fa-eye-dropper"></i>
</label>

    <input  type="range" id="penSize" min="1" max="20" value="4" />

    <label style="font-weight: bold; color: red;" id="eraserTool" title="Eraser Tool"><i class="fas fa-eraser"></i></label>
    <input type="range" id="eraserSize" min="20" max="250" value="60" />

    <label  style="font-weight: bold; color: green;" for="bgColor" id="bgColorLabel" title="Canvas Background">
  <i class="fas fa-fill-drip"></i>
</label>
<input type="color" id="bgColor" style="display: none;" />


    <label style="font-weight: bold; color: #3333cc;"  id="resetBg" title="Reset background color"><i class="fas fa-refresh"></i></label>

    <label style="font-weight: bold; color: #408000;" id="undo" title="Undo drawing"><i class="fas fa-undo"></i></label>
    <label style="font-weight: bold; color: red;" id="clear" type="button" title="Delete All drawing"><i class="fas fa-trash"></i></label>
  </div>
</div>

<div id="eraserCursor"></div>
<canvas id="drawingCanvas"></canvas>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const canvas = document.getElementById('drawingCanvas');
  const ctx = canvas.getContext('2d');
  const eraserCursor = document.getElementById('eraserCursor');
  const bgColorPicker = document.getElementById('bgColor');
  const resetBgBtn = document.getElementById('resetBg');
  const penColorInput = document.getElementById('penColor');
  const penIcon = document.querySelector('#penColorLabel i');

  // Set initial color
  penIcon.style.color = penColorInput.value;

  penColorInput.addEventListener('input', () => {
    penIcon.style.color = penColorInput.value;
  });


  let drawing = false, erasing = false;
  let controlsEnabled = false;
  let lastX = 0, lastY = 0;
  const history = [];
  const defaultBgColor = ""; // Transparent or set to a specific default if desired

  function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }
  window.addEventListener('resize', resize);
  resize();

  function pos(e) {
    if (e.touches) e = e.touches[0];
    return { x: e.clientX, y: e.clientY };
  }
  function updateEraser(x,y) {
    const size = Number(eraserSize.value);
    eraserCursor.style.width = size+'px';
    eraserCursor.style.height = size+'px';
    eraserCursor.style.left = x-size/2+'px';
    eraserCursor.style.top = y-size/2+'px';
  }

  function start(e) {
    if (!controlsEnabled) return;
    drawing = true;
    history.push(ctx.getImageData(0,0,canvas.width,canvas.height));
    const p = pos(e); lastX=p.x; lastY=p.y;
    draw(e);
  }
  function end() {
    drawing = false;
    ctx.globalCompositeOperation = 'source-over';
  }
  function draw(e) {
    if (!drawing) return;
    const p = pos(e);
    const size = erasing ? Number(eraserSize.value) : Number(penSize.value);
    ctx.lineWidth = size;
    ctx.lineCap = 'round';
    ctx.globalCompositeOperation = erasing ? 'destination-out' : 'source-over';
    ctx.strokeStyle = penColor.value;
    if (erasing) updateEraser(p.x,p.y);
    ctx.beginPath();
    ctx.moveTo(lastX,lastY);
    ctx.lineTo(p.x,p.y);
    ctx.stroke();
    lastX=p.x; lastY=p.y;
  }

  canvas.addEventListener('pointerdown', start);
  canvas.addEventListener('pointermove', draw);
  canvas.addEventListener('pointerup', end);
  canvas.addEventListener('pointercancel', end);

  penTool.onclick = () => {
    erasing = false;
    eraserCursor.style.display='none';
    canvas.style.pointerEvents = 'auto';
  };
  eraserTool.onclick = () => {
    erasing = true;
    eraserCursor.style.display='block';
    canvas.style.pointerEvents = 'auto';
  };
  undo.onclick = () => {
    if (history.length) ctx.putImageData(history.pop(),0,0);
  };
  document.getElementById('clear').addEventListener('click', () => {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    history.length = 0;
  });

  bgColorPicker.addEventListener('input', () => {
    canvas.style.backgroundColor = bgColorPicker.value;
  });

  resetBgBtn.addEventListener('click', () => {
    canvas.style.backgroundColor = defaultBgColor;
    bgColorPicker.value = "#ffffff";
  });

  toggleControls.onclick = () => {
    const isVisible = controls.style.display === 'flex';
    controls.style.display = isVisible ? 'none' : 'flex';
    controlsEnabled = !isVisible;
    canvas.style.pointerEvents = controlsEnabled ? 'auto' : 'none';
    if (erasing && controlsEnabled) eraserCursor.style.display = 'block';
    else eraserCursor.style.display = 'none';
  };

  canvas.addEventListener('pointerdown', function(e) {
    this.setPointerCapture(e.pointerId);
  });
  canvas.addEventListener('pointerup', function(e) {
    this.releasePointerCapture(e.pointerId);
  });
});
</script>
